## å±€éƒ¨æœ€å°å€¼ä¸éç‚¹

ä¸ºä»€ä¹ˆoptimizationä¼šfailï¼Ÿ

ä½ ç»å¸¸ä¼šå‘ç°ï¼Œéšç€ä½ çš„å‚æ•°ä¸æ–­updateï¼Œä½ çš„trainingçš„lossä¸ä¼šå†ä¸‹é™ï¼Œä½†æ˜¯ä½ å¯¹è¿™ä¸ªlossè¿˜æ˜¯ä¸æ»¡æ„ï¼Œ  
æœ‰æ—¶å€™ä½ ç”šè‡³å‘ç°ä½ çš„modelä¸€å¼€å§‹å°±trainä¸èµ·æ¥ï¼Œä¸ç®¡ä½ æ€ä¹ˆupdateä½ çš„å‚æ•°ï¼Œä½ çš„losså§‹ç»ˆæ‰ä¸ä¸‹å»ï¼Œ  

è¿‡å»å¸¸æœ‰çš„ä¸€ä¸ªçŒœæƒ³æ˜¯ï¼Œèµ°åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œè¿™ä¸ªåœ°æ–¹å‚æ•°å¯¹lossçš„å¾®åˆ†ä¸º0ï¼Œæ­¤æ—¶ï¼Œgradient descentæ²¡æœ‰åŠæ³•å†updateå‚æ•°

å¸¸æœ‰äººè¯´ï¼Œåšdeep learning ç”¨gradient descent ï¼Œä½ ä¼šå¡åœ¨local minima  

ä½†ä½ å†™paperçš„æ—¶å€™ï¼Œåƒä¸‡ä¸è¦è¯´ä»€ä¹ˆå¡åœ¨local minimaè¿™ç§äº‹æƒ…ï¼Œåˆ«äººä¼šè§‰å¾—ä½ éå¸¸æ²¡æœ‰æ°´å‡†ï¼Œ  

ä¸ºä»€ä¹ˆï¼Ÿ
å› ä¸ºä¸æ˜¯åªæœ‰local minimaçš„gradientä¸º0ï¼Œè¿˜æœ‰å…¶ä»–æƒ…å†µï¼Œæ¯”å¦‚saddle point  

saddle point å°±æ˜¯ gradient æ˜¯0 ï¼Œä½†ä¸æ˜¯local minima  ,ä¹Ÿä¸æ˜¯local maximaçš„åœ°æ–¹ï¼Œå‰åæ¯”å®ƒé«˜ï¼Œå·¦å³æ¯”å®ƒä½ã€‚  

gradientä¸º0çš„ç‚¹ï¼Œç»Ÿç§°ä¸ºcritical point ,æ‰€ä»¥å‘¢ä½ å¯ä»¥è¯´ä½ çš„gradientæ²¡æœ‰åŠæ³•å†ä¸‹é™ï¼Œä¹Ÿè®¸æ˜¯å› ä¸ºå¡åœ¨äº†critical pointã€‚ä½†ä½ ä¸èƒ½è¯´å¡åœ¨local minimaã€‚


é—®é¢˜ï¼šä½ å¡åœ¨äº†æŸä¸ªcritical point ï¼Œå¦‚ä½•åŒºåˆ†æ˜¯local minima è¿˜æ˜¯ saddle point?  

ä¸ºä»€ä¹ˆæˆ‘æƒ³è¦çŸ¥é“è¿™ä¸€ç‚¹ï¼Ÿ
å› ä¸ºå¦‚æœå¡åœ¨local minimaï¼Œé‚£å°±æ˜¯æ²¡è·¯å¯èµ°ï¼Œsaddle pointæ—è¾¹è¿˜æ˜¯æœ‰è·¯å¯èµ°çš„ï¼Œè¿˜æ˜¯å¯ä»¥è®©ä½ çš„lossæ›´ä½çš„ï¼Œ

![image-20220214092750643](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220214092750643.png)

æ€ä¹ˆåŒºåˆ†ï¼Œç”¨åˆ°ä¸€ç‚¹æ•°å­¦  

## Tayler series Approximation

è™½ç„¶æˆ‘ä»¬æ²¡åŠæ³•å®Œæ•´çŸ¥é“loss å‡½æ•°é•¿ä»€ä¹ˆæ ·ï¼Œä½†å¦‚æœç»™å®šä¸€ç»„å‚æ•°,åœ¨å®ƒé™„è¿‘çš„loss func    tionæ˜¯æœ‰åŠæ³•è¢«å†™å‡ºæ¥çš„ã€‚

$L(\theta)$ around $\theta = \theta'$ can be approximated below 

$$
\LARGE
(\theta) \approx L({\color{blue}\theta'}) + (\theta - {\theta}')^T {\color{green}g}+\frac{1}{2}(\theta - {\color{blue}\theta'})^T {\color{red}H} (\theta - {\color{blue}\theta'})
$$

<font size="5">Gradient <font color="green">g</font> is a vector</font>
$$
\LARGE
{\color{green}g}=\nabla L({\color{blue}\theta'})\ \ \ \ 
{\color{green}g_i}=\frac{\partial{L({\color{blue}\theta'})}}{\partial{\theta_i}}
$$

$L(\theta)$è¿™ä¸ªloss functionï¼Œè¿™ä¸ªerror surfaceåœ¨$\theta'$é™„è¿‘ï¼Œå¯ä»¥ç”¨åè¾¹é‚£ä¸¤é¡¹ç›¸åŠ æ¥è¿‘ä¼¼ï¼Œç¬¬ä¸€é¡¹æ˜¯ç»¿è™šçº¿ï¼Œç¬¬äºŒé¡¹æ˜¯çº¢è™šçº¿

![image-20220214102634418](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220214102634418.png)

![image-20220214102657034](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220214102657034.png)



![image-20220214102714521](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220214102714521.png)

gæ˜¯ä¸€æ¬¡å¾®åˆ†ï¼ŒHé‡Œé¢æœ‰äºŒæ¬¡å¾®åˆ†çš„é¡¹







gæ˜¯ä¸€ä¸ªå‘é‡ï¼Œ$g_i$å°±æ˜¯gçš„ç¬¬iä¸ªcomponent

åœ¨ä¸Šé¢çº¢è‰²Hï¼šæµ·å¡çŸ©é˜µ  

Hessian <font size="8" color="red">H</font> is a <u>matrix</u>
$$
\LARGE
{\color{red}H}_{ij}=\frac{\partial^2}{\partial{\theta_i}\partial{\theta_j}} L({\color{blue}\theta'})
$$

Hé‡Œé¢æ”¾çš„æ˜¯Lçš„äºŒæ¬¡å¾®åˆ†ï¼Œç¬¬iä¸ªrowï¼Œç¬¬jä¸ªcolumnçš„å€¼ï¼Œå°±æ˜¯$L(\theta')$å…ˆå¯¹$\theta_i$åšå¾®åˆ†ï¼Œå†å¯¹$\theta_j$åšå¾®åˆ†ï¼Œï¼ˆæ¬¡åºä¸å½±å“äºŒé˜¶å¯¼æ•°?ï¼‰åšä¸¤æ¬¡å¾®åˆ†ä¹‹åçš„ç»“æœå°±æ˜¯$H_{ij}$


å¦‚æœæˆ‘ä»¬ä»Šå¤©èµ°åˆ°ä¸€ä¸ªcritical pointï¼Œé‚£æ„å‘³ç€gradientä¸º0ï¼Œå³ç»¿è‰²é¡¹ä¸º0ï¼Œåªå‰©ä¸‹çº¢è‰²é¡¹ï¼Œæ ¹æ®çº¢è‰²é¡¹æ¥åˆ¤æ–­$\theta'$é™„è¿‘çš„error surfaceé•¿ä»€ä¹ˆæ ·å­ï¼Œè¿›è€Œå¯ä»¥åˆ¤æ–­è¯¥ç‚¹æ˜¯local min,local max,or saddle pointã€‚

![image-20220214103427261](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220214103427261.png)

æ¥çœ‹çœ‹æ€ä¹ˆæ ¹æ®çº¢è‰²é¡¹æ¥åˆ¤æ–­$\theta'$é™„è¿‘çš„çŠ¶å†µï¼Œ

![image-20220214211032564](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220214211032564.png)

![image-20220214211412007](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220214211412007.png)

![image-20220214211844470](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220214211844470.png)


Hä¸ä½†èƒ½å‘Šè¯‰æˆ‘ä»¬æ˜¯å¦saddle pointï¼Œè¿˜may tell us parameter update direction.  


![image-20220214212019975](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220214212019975.png)

![image-20220214213441900](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220214213441900.png)

å›åˆ°åˆšæ‰é‚£ä¸ªæ —å­ğŸŒ°

![image-20220214215928644](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220214215928644.png)

## Saddle point v.s. local minima  
åˆ°P11 25ï¼š35

saddle point å’Œ local minima è°æ›´å¸¸è§ï¼Ÿ  

![image-20220215093038482](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215093038482.png)

![image-20220215093232064](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215093232064.png)

![image-20220215093457956](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215093457956.png)

åœ¨ä¸‰ç»´ç©ºé—´ä¸­æ— è·¯å¯èµ°çš„æƒ…å†µï¼Œåœ¨é«˜ç»´ç©ºé—´æ˜¯æœ‰è·¯å¯èµ°çš„ï¼Œerror surfaceä¼šä¸ä¼šä¹Ÿä¸€æ ·ï¼Ÿ

æ¯”å¦‚åœ¨äºŒç»´ç©ºé—´ä¸­æ˜¯ä¸ªlocal minimaï¼Œä¼šä¸ä¼šåœ¨ä¸‰ç»´ç©ºé—´ä¸­åªæ˜¯ä¸ªsaddle pointï¼Œ
ä¼šä¸ä¼šåœ¨äºŒç»´çš„ç©ºé—´ä¸­æˆ‘ä»¬æ— è·¯å¯èµ°ï¼Œåœ¨æ›´é«˜ç»´çš„ç©ºé—´ä¸­å…¶å®æœ‰è·¯å¯ä»¥èµ°ï¼Œç»´åº¦è¶Šé«˜å¯ä»¥èµ°çš„è·¯å°±è¶Šå¤šï¼Ÿ
ä»Šå¤©æˆ‘ä»¬å†è®­ç»ƒä¸€ä¸ªnetworkçš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„å‚æ•°åŠ¨è¾„ç™¾ä¸‡ï¼Œåƒä¸‡ï¼Œä¸Šäº¿ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„error surfaceå…¶å®æ˜¯åœ¨ä¸€ä¸ªéå¸¸é«˜çš„ç»´åº¦ä¸­ï¼Œæˆ‘ä»¬çš„å‚æ•°æœ‰å¤šå°‘ï¼Œå°±ä»£è¡¨æˆ‘ä»¬error surfaceçš„ç»´åº¦æœ‰å¤šå°‘ï¼Œæœ‰ä¸€åƒä¸‡ä¸ªå‚æ•°ï¼Œnetworkçš„ç»´åº¦å°±æ˜¯1000ä¸‡ï¼Œç»´åº¦è¿™ä¹ˆé«˜ï¼Œä¼šä¸ä¼šå…¶å®æœ‰å¾ˆå¤šè·¯å¯ä»¥èµ°å‘¢ï¼Ÿå¦‚æœè·¯å¾ˆå¤šï¼Œä¼šä¸ä¼šå…¶å®local minimaæœ¬æ¥å°±å¾ˆå°‘å‘¢ï¼Ÿ

![image-20220215101402567](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215101402567.png)

ç»éªŒä¸Šæ¥è¯´ï¼Œå¦‚æœä½ å®åšneural networkï¼Œä¼šå‘ç°æ”¯æŒä¸Šè¿°è®ºç‚¹ã€‚  

ä¸‹å›¾å¯è§ï¼Œå®åšä¸­ï¼Œlocal minimaå¾ˆå°‘ï¼Œä½ å¾€å¾€å¡åœ¨äº†saddle point  

![image-20220215102013652](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215102013652.png)

ä½ çœ‹åˆ°å›¾é‡Œ ä¸‹è¾¹ minimum ratio 0.5å¤„ä¸€å †ç‚¹   è¯´æ˜å•¥   è¯´æ˜å®åšä¸­ï¼Œæç«¯æƒ…å†µä¸‹ï¼Œä¹Ÿè¿˜æœ‰ä¸€åŠçš„caseç‰¹å¾å€¼æ˜¯è´Ÿçš„ï¼Œæœ‰ä¸€åŠçš„è·¯å…¶å®éƒ½è¿˜å¯ä»¥è®©lossä¸‹é™ï¼Œç»éªŒä¸Šæ¥è¯´ï¼Œlocal minimaçœŸçš„å¾ˆå°‘ï¼Œå¤šæ•°æ—¶å€™ï¼Œä½ trainåˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œä½ çš„gradientçœŸçš„å¾ˆå°ï¼Œä½ çš„å‚æ•°ä¸å†updateäº†ï¼Œå¾€å¾€æ˜¯å¡åœ¨äº†saddle pointã€‚

ä¸‹é¢æ¥çœ‹å¡åœ¨saddle pointé™„è¿‘éå¸¸å¹³å¦çš„åœ°æ–¹ï¼Œæœ‰ä»€ä¹ˆè§£å†³æ–¹æ³•ï¼Ÿ

![image-20220215104019675](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215104019675.png)

## Tips for training
Batch and Momentum

## Batch
ä¸ºå•¥è®­ç»ƒä¸­è¦ç”¨batch
å®é™…åœ¨ç®—å¾®åˆ†çš„æ—¶å€™ï¼Œä¸æ˜¯å¯¹æ‰€æœ‰dataç®—å‡ºæ¥çš„lossåšå¾®åˆ†ï¼Œè€Œæ˜¯æŠŠæ‰€æœ‰dataåˆ†æˆä¸€ä¸ªä¸ªbatchï¼ˆmini batch)ï¼Œæ¯ä¸ªbatchçš„å¤§å°æ˜¯B,æ¯æ¬¡åœ¨updateå‚æ•°çš„æ—¶å€™ï¼Œæ˜¯æ‹¿ä¸€ä¸ªBè¿™ä¹ˆå¤šèµ„æ–™å‡ºæ¥ï¼Œç®—ä¸ªlossï¼Œç®—ä¸ªgradientï¼Œupdateå‚æ•°ï¼Œå†æ‹¿å¦ä¸€ç¬”Bè¿™ä¹ˆå¤šèµ„æ–™ï¼Œ  
æˆ‘ä»¬ä¸ä¼šæ‹¿æ‰€æœ‰èµ„æ–™ä¸€èµ·å»ç®—å‡ºLossï¼Œåªä¼šæ‹¿ä¸€ä¸ªbatchçš„èµ„æ–™ï¼Œ  
æ‰€æœ‰çš„batchçœ‹è¿‡ä¸€éå«åšä¸€ä¸ªepochï¼Œäº‹å®ä¸Šï¼Œä½ åœ¨æŠŠæ‰€æœ‰èµ„æ–™åˆ†æˆä¸€ä¸ªä¸ªbatchçš„æ—¶å€™ï¼Œä½ ä¼šåšä¸€ä»¶äº‹æƒ…å«åšShuffleï¼Œ  
Shuffleæœ‰å¾ˆå¤šåšæ³•ï¼Œä¸€ä¸ªå¸¸è§åšæ³•å°±æ˜¯ï¼š
åœ¨æ¯ä¸€ä¸ªepochå¼€å§‹ä¹‹å‰ï¼Œä¼šåˆ†ä¸€æ¬¡batchï¼Œæ¯ä¸€ä¸ªepochçš„batchéƒ½ä¸ä¸€æ ·ï¼Œå“ªäº›èµ„æ–™åœ¨åŒä¸€ä¸ªepoché‡Œé¢ï¼Œæ¯ä¸ªbatchéƒ½ä¸åŒï¼Œ  

![image-20220215140728963](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215140728963.png)

## Small Batch v.s. Large Batch  
ä¸ºå•¥è¦ç”¨batchï¼Ÿ  
æ¯”è¾ƒå·¦å³ä¸¤ä¸ªcaseï¼Œå‡è®¾æœ‰20ç¬”è®­ç»ƒèµ„æ–™ï¼Œå·¦è¾¹çš„caseå°±æ˜¯æ²¡æœ‰ç”¨batchï¼ˆæˆ–è€…è¯´æˆ‘çš„batchè®¾ç½®å¾—å’Œæˆ‘çš„è®­ç»ƒèµ„æ–™ä¸€æ ·å¤§ï¼Œè¿™ç§çŠ¶å†µå«åšfull batchï¼‰ï¼Œå³è¾¹ç”¨äº†ï¼Œbatch size=1 ï¼Œè¿™æ˜¯ä¸¤ä¸ªæœ€æç«¯çš„æƒ…å†µï¼Œ  
çœ‹å·¦è¾¹ï¼Œå› ä¸ºæ²¡æœ‰ç”¨batchï¼Œæˆ‘ä»¬æœ‰20ç¬”è®­ç»ƒèµ„æ–™ï¼Œæˆ‘ä»¬çš„modelå¿…é¡»æŠŠ20ç¬”èµ„æ–™éƒ½çœ‹å®Œï¼Œæ‰èƒ½å¤Ÿè®¡ç®—Lossï¼Œæ‰èƒ½å¤Ÿè®¡ç®—gradientï¼Œ  
å¦‚æœbatch size=1çš„è¯å‘¢ï¼Œä»£è¡¨æˆ‘ä»¬æ¯æ¬¡updateå‚æ•°çš„æ—¶å€™ï¼Œåªè¦çœ‹ä¸€ç¬”èµ„æ–™å°±å¥½äº†ï¼Œåœ¨ä¸€ä¸ªepoché‡Œé¢ï¼Œupdate20æ¬¡å‚æ•°ï¼Œ  
ç”¨ä¸€ç¬”èµ„æ–™ç®—å‡ºæ¥çš„lossæ˜¾ç„¶æ˜¯æ¯”è¾ƒnoisyçš„ï¼Œæ‰€æœ‰ä¼šå‘ç°è¿™20ä¸ªupdateçš„æ–¹å‘æ›²æ›²æŠ˜æŠ˜çš„ï¼Œå·¦è¾¹å’Œå³è¾¹å“ªä¸€ä¸ªæ¯”è¾ƒå¥½å‘¢ï¼Ÿ  
å·¦è¾¹è¿™ç§æ–¹å¼è“„åŠ›æ¯”è¾ƒé•¿ï¼ŒæŠ€èƒ½å†·å´æ—¶é—´æ¯”è¾ƒé•¿ï¼Œä½†æ˜¯èµ°å¾—æ¯”è¾ƒç¨³ï¼Œ  
å®é™…ä¸Šï¼Œè€ƒè™‘å¹³è¡Œè¿ç®—çš„è¯ï¼Œå·¦è¾¹ä¸ä¸€å®šæ—¶é—´é•¿ï¼Œæ¥çœ‹å®éªŒç»“æœï¼Œ  
äº‹å®ä¸Šï¼Œæ¯”è¾ƒå¤§çš„Batch Sizeï¼Œä½ è¦ç®—Lossï¼Œå†è¿›è€Œç®—gradientï¼Œæ‰€éœ€è¦çš„æ—¶é—´ï¼Œä¸ä¸€å®šæ¯”å°çš„batch sizeè¦èŠ±çš„æ—¶é—´é•¿ï¼Œ  
ä¸‹é¢è¿™ä¸ªæ˜¯MNISTï¼ˆæ‰‹å†™æ•°å­—è¾¨è¯†ï¼‰çš„æ —å­ï¼ŒMNISTæ˜¯æœºå™¨å­¦ä¹ çš„æœè‡ï¼Œ

![image-20220215142928308](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215142928308.png)

æ³¨æ„æœ€ä¸Šé¢é‚£äº›é“¾æ¥ï¼Œå¯ä»¥çœ‹åˆ°æ—¶ä»£çš„æ¼”è¿›ï¼Œä»¥å‰GPUéœ€è¦ç®—å‡ åˆ†é’Ÿçš„ï¼Œç°åœ¨10ç§’æå®šï¼Œ  

![image-20220215143347382](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215143347382.png)

![image-20220215143605067](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215143605067.png)

çœ‹åˆ°è¿™é‡Œï¼Œå‘ç°æ—¢ç„¶å¤§çš„batch sizeåœ¨å¹¶è¡Œè®¡ç®—æ—¶å¹¶ä¸æ¯”å°batch sizeçš„æ…¢ï¼Œè€Œä¸”å°batch sizeçš„éœ€è¦èŠ±æ›´å¤šçš„æ—¶é—´å»seeå…¨éƒ¨çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¯´å¤§çš„batch sizeæ¯”è¾ƒå¥½å—ï¼Ÿä¸æ˜¯  
å‘ç°ï¼š
noisyçš„gradientåè€Œå¯ä»¥å¸®åŠ©trainingï¼Œä¸‹å›¾å¯çœ‹åˆ°ï¼Œbatch sizeè¶Šå¤§ï¼Œvalidation setä¸Šçš„æ•ˆæœè¶Šå·®ã€‚  
è¿™ä¸ªä¸æ˜¯overfittingï¼Œå› ä¸ºåœ¨trainning set å’Œvalidation setä¸Šéƒ½å·®ã€‚  
è¿™ä¸ªä¹Ÿä¸æ˜¯model biasï¼Œå› ä¸ºæ˜¯åŒæ ·çš„æ¨¡å‹ã€‚  

![image-20220215145006676](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215145006676.png)

ä¸ºä»€ä¹ˆä¼šè¿™æ ·å­å‘¢ï¼Ÿ  
å› ä¸ºsmall batch sizeæ›´å®¹æ˜“è·³å‡ºå±€éƒ¨æœ€ä¼˜  
small batchæƒ…å†µä¸‹ï¼Œæ¯ä¸ªbatchä½ ç”¨çš„loss functionéƒ½æ˜¯ç•¥æœ‰å·®å¼‚çš„ï¼Œ

![image-20220215145726607](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215145726607.png)

å¦ä¸€ä¸ªç¥å¥‡çš„åœ°æ–¹æ˜¯ï¼Œsmall batchå¯¹testing dataä¹Ÿæœ‰å¸®åŠ©ã€‚  
å‡è®¾ä½ é€šè¿‡ä¸€äº›æ–¹æ³•ï¼ˆæ¯”å¦‚è°ƒæ•´learning rate)æŠŠlarge batchè°ƒå¾—å’Œsmall batchåœ¨training accuracyä¸Šä¸€æ ·å¥½ï¼Œé‚£ä¹ˆåœ¨testing accuracyä¸Šï¼Œè¿˜æ˜¯small batchæ›´å¥½äº›ã€‚  
large batchæ›´å®¹æ˜“overfitting  

å¥½minimaå’Œåminima
å¦‚æœä¸€ä¸ªminimaåœ¨ä¸€ä¸ªå³¡è°·é‡Œé¢ï¼Œå°±è®¤ä¸ºå®ƒæ˜¯åminimaï¼Œåœ¨å¹³åŸä¸Šï¼Œå°±æ˜¯å¥½çš„minima
small batchå®¹æ˜“è·³å‡ºå³¡è°·ï¼Œå½“ç„¶è¿™åªæ˜¯ä¸€ç§è§£é‡Šï¼Œä¸æ˜¯æ‰€æœ‰äººéƒ½ç›¸ä¿¡ã€‚  

![image-20220215152228121](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215152228121.png)

![image-20220215152539064](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215152539064.png)

æœ€åé‚£è¡Œgeneralizationå°±æ˜¯æŒ‡åœ¨testing dataä¸Šçš„accuracyæ¯”è¾ƒå¥½ã€‚  

æœ‰æ²¡æœ‰å¯èƒ½é±¼ä¸ç†ŠæŒå…¼å¾—å‘¢ï¼Ÿæœ‰å¯èƒ½ï¼Œæœ‰å¾ˆå¤šè¿™æ–¹é¢ç ”ç©¶ï¼š  

![image-20220215152829747](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215152829747.png)
## Momentum  
åŠ¨é‡æ¢¯åº¦ä¸‹é™
å¦ä¸€ä¸ªå¯ä»¥å¯¹æŠ—saddle point å’Œ local minimaçš„æŠ€æœ¯ï¼Œ  
å®ƒçš„æ¦‚å¿µå‘¢å°±æ˜¯æƒ³è±¡error sufaceå°±æ˜¯çœŸæ­£çš„æ–œå¡ï¼Œè€Œæˆ‘ä»¬çš„å‚æ•°æ˜¯ä¸€ä¸ªçƒï¼ŒæŠŠçƒä»æ–œå¡ä¸Šæ»šä¸‹æ¥ï¼Œå¦‚æœæ˜¯gradient descentï¼Œå®ƒèµ°åˆ°critical pointå°±åœä½äº†ï¼Œ

![image-20220215153337427](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215153337427.png)

## (Vanilla) Gradient Descent
å¤ä¹ ä¸‹åŸæ¥çš„gradient descentä»€ä¹ˆæ ·ï¼Ÿ  
vanillaæ„æ€å°±æ˜¯ä¸€èˆ¬çš„  

![image-20220215153746658](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215153746658.png)

## Gradient Descent + Momentum  
æ¯æ¬¡ç§»åŠ¨å‚æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸æ˜¯åªå¾€gradientçš„åæ–¹å‘ç§»åŠ¨å‚æ•°ï¼Œç°åœ¨å‘¢æ˜¯gradientçš„åæ–¹å‘åŠ ä¸Šå‰ä¸€æ­¥ç§»åŠ¨çš„æ–¹å‘ï¼Œ

![image-20220215154336227](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215154336227.png)

må¯ä»¥å†™æˆä¹‹å‰ç®—å‡ºæ¥çš„æ‰€æœ‰gradientçš„weighted sumã€‚   

åŠ ä¸Šmomentumåï¼Œä¸¤ç§è§£è¯»
1. gradientçš„åæ–¹å‘åŠ ä¸Šå‰ä¸€æ¬¡ç§»åŠ¨æ–¹å‘ï¼Œ
2. è€ƒè™‘è¿‡å»æ‰€æœ‰gradient çš„æ€»å’Œã€‚  

![image-20220215154735413](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215154735413.png)

ä¸€ä¸ªæ›´ç®€å•çš„æ —å­ï¼š

![image-20220215155022151](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215155022151.png)

## Concluding Remarks
* Critical points have zero gradients.  
* Critical points can be either saddle points or local minima.  
    * Can be determined by the Hessian matrix.  
    * It is possible to escape saddle points along the derection of eigenvectors of the Hessian matrix.
    * Local minima may be rare.
* smaller batch size and momentum help escape critical points.  

critical point ä¸æ˜¯ä½ åœ¨è®­ç»ƒnetworkæ—¶é¢ä¸´çš„æœ€å¤§éšœç¢ï¼š
## Error surface is rugged ..
Tips for training :Adaptive Learning Rate  
å³ç»™æ¯ä¸€ä¸ªå‚æ•°ä¸åŒçš„learning rate  

åœ¨è®­ç»ƒä¸€ä¸ªnetworkçš„æ—¶å€™ï¼Œä¼šæŠŠlossè®°å½•ä¸‹æ¥ï¼Œä½ çš„lossåŸæ¥å¾ˆå¤§ï¼Œæ¨ªè½´ä»£è¡¨ä½ å‚æ•°updateçš„æ¬¡æ•°ï¼Œéšç€updateæ¬¡æ•°å¢å¤§ï¼Œlossä¼šè¶Šæ¥è¶Šå°ï¼Œæœ€åå°±å¡ä½ï¼Œè¿™æ—¶å¤§å®¶å°±ä¼šçŒœæ˜¯å¦èµ°åˆ°äº†critical pointï¼Œåœ¨è¿™ä¸ªæ —å­ä¸­ï¼Œlossä¸å†ä¸‹é™çš„æ—¶å€™ï¼Œgradientå¹¶æ²¡æœ‰å˜å¾—å¾ˆå°ï¼Œ

![image-20220215160314184](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215160314184.png)

æ‰€ä»¥å¦‚æœæˆ‘ä»¬å®åšä¸­ï¼Œå¾ˆå°‘å¡åˆ°local minimaæˆ–è€…saddle pointï¼Œé‚£ä¹‹å‰é‚£å¼ å›¾æ˜¯æ€ä¹ˆåšå‡ºæ¥çš„å‘¢ï¼Ÿ

è¦æƒ³æŠŠæ¥è¿‘critical pointï¼Œç”¨ä¸€èˆ¬çš„gradient descentå…¶å®æ˜¯åšä¸åˆ°çš„ã€‚  
ä¸€èˆ¬å®åšä¸­ï¼Œä½ ç»å†çš„å¤§å¤šæ•°æƒ…å†µæ˜¯ï¼Œåœ¨gradientè¿˜å¾ˆå¤§çš„æ—¶å€™ï¼Œä½ çš„losså°±æ‰ä¸ä¸‹å»äº†ã€‚  
ä½ çœŸæ­£è¦æ€ªç½ªçš„ä¸æ˜¯critical pointè€Œæ˜¯å…¶ä»–åŸå› ã€‚  

![image-20220215160813554](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215160813554.png)

å¦‚æœä¸æ˜¯å› ä¸ºcritical pointï¼Œä¸ºå•¥trainingä¼šå¡ä½å‘¢ï¼Œçœ‹ä¸ªç®€å•æ —å­ï¼š  

![image-20220215161728525](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220215161728525.png)

å¯¹äºåˆ†å‚å¤æ‚çš„error surfaceï¼Œä½ è¦train ä¸€ä¸ªdeep neural networkï¼Œgradient descentæ˜¯ä½ å”¯ä¸€å¯ä»¥ä¾èµ–çš„å·¥å…·ï¼Œè¿™ä¸ªä¾‹å­ä¸­å‡¸ä¼˜åŒ–æœ‰æ›´å¥½çš„å‡æ³•ï¼Œä½†ä½ ç»ˆå½’ä¼šé‡åˆ°åªèƒ½ç”¨gradient desentæ¥è§£å†³çš„é—®é¢˜ã€‚ä½†gradient descentè¿è¿™ä¹ˆç®€å•çš„error sufaceéƒ½åšä¸å¥½ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ›´å¥½çš„gradient descentçš„ç‰ˆæœ¬ã€‚  

åˆ°P13 09ï¼š32

## Different parameters needs different learning rate
æ€ä¹ˆæ ·å®¢åˆ¶åŒ–learning rateå‘¢ï¼Ÿä¸åŒçš„å‚æ•°éœ€è¦ä»€ä¹ˆæ ·çš„learning rateå‘¢ï¼Ÿ
åˆšæ‰çš„æ —å­ä¸­èƒ½çœ‹åˆ°ä¸€ä¸ªå¤§åŸåˆ™ï¼šå¦‚æœåœ¨æŸä¸€ä¸ªæ–¹å‘ä¸Šï¼Œgradientçš„å€¼å¾ˆå°ï¼Œéå¸¸çš„å¹³å¦ï¼Œé‚£æˆ‘ä»¬å°±å¸Œæœ›learning rateå¤§ä¸€ç‚¹ï¼Œå¦‚æœåœ¨æŸä¸ªæ–¹å‘ä¸Šå¡åº¦å¾ˆå¤§ï¼Œå¾ˆé™¡å³­ï¼Œæˆ‘ä»¬å°±å¸Œæœ›learning rateå°ä¸€ç‚¹ï¼Œ
é‚£ä¹ˆlearning rateè¦å¦‚ä½•è‡ªåŠ¨åœ°æ ¹æ®gradientçš„å¤§å°è€Œè°ƒæ•´å‘¢ï¼Ÿ
æˆ‘ä»¬éœ€è¦æ”¹ä¸€ä¸‹gradient descentåŸæ¥çš„å¼å­ï¼š
ä»¥å‰æ˜¯è®²æ‰€æœ‰å‚æ•°çš„æƒ…å†µï¼Œè¿™é‡Œé—®ç®€åŒ–é—®é¢˜ï¼Œå…ˆåªçœ‹ä¸€ä¸ªå‚æ•°çš„æƒ…å†µ

Formulation for **one** parameter:
$$
åŸæ¥çš„å¼å­
\LARGE
\theta_i^{t+1} \leftarrow \theta_i^t - \eta g_i^t\\
\LARGE
g_i^t = \frac{\partial{L}}{\partial{\theta_i}}|_{\theta=\theta^t}
$$
tæ˜¯iterationçš„æ¬¡æ•°

ç°åœ¨æ”¹æˆï¼š
$$
\LARGE
\theta_i^{t+1} \leftarrow \theta_i^t - \frac{\eta}{\sigma_i^t}g_i^t
$$

ä¸Šå¼ä¸­
$$
\LARGE
\frac{\eta}{\sigma_i^t}
$$


![image-20220216085147539](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220216085147539.png)

æ˜¯Parameter dependentçš„,ä¸‹é¢æ¥çœ‹çœ‹å®ƒæœ‰ä»€ä¹ˆå¸¸è§çš„è®¡ç®—æ–¹å¼ï¼š
290 æ€è·¯å°±æ˜¯ï¼šè·³å‘æ—¶æ¯ä¸€æ­¥çš„è·ç¦»ï¼Œæ ¹æ®è¿™ä¸ªæ–¹å‘ä¸Šçš„å¡åº¦åšåŒå‘è°ƒæ•´ã€å¼¹å¹•ã€‘

Root Mean Square
$$
\LARGE
\theta_i^{t+1} \leftarrow \theta_i^t - \frac{\eta}{\sigma_i^t}g_i^t\ \ \ \sigma_i^t=\sqrt{\frac{1}{t+1}\sum_{i=0}^t(g_i^t)^2 }
$$

![image-20220216090656474](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220216090656474.png)

ä¸Šé¢è¿™æ‹›è¢«ç”¨åœ¨ä¸€ä¸ªå«Adagradçš„æ–¹æ³•é‡Œé¢ã€‚  

ä¸ºå•¥è¿™æ‹›èƒ½åšåˆ°å¡åº¦å¤§æ—¶å€™lerning rateå‡å°ï¼Œå¹³å¦çš„æ—¶å€™ï¼Œlearning rateå¢å¤§å‘¢

![image-20220216091048467](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220216091048467.png)

ä¸Šè¿°æ–¹æ³•å¹¶ä¸æ˜¯ç»ˆæç‰ˆæœ¬ï¼Œ
å®ƒè¿˜æœ‰é—®é¢˜ï¼šå°±ç®—æ˜¯åŒä¸€ä¸ªå‚æ•°ï¼Œå®ƒéœ€è¦çš„learning rateä¹Ÿä¼šéšæ—¶é—´æ”¹å˜ï¼Œä¸Šè¿°æ–¹æ³•åŒä¸€ä¸ªå‚æ•°ï¼Œå¯¹åº”åŒæ ·çš„learning rateã€‚
çœ‹ä¸‹é¢è¿™ä¸ªæ–°æœˆå‹å·çš„error surface  
å¯¹äºåŒä¸€ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬ä¹ŸæœŸå¾…ä¸åŒçš„learning rate  

![image-20220216091526423](https://raw.githubusercontent.com/lunnche/picgo-image/main/image-20220216091526423.png)

RMSProp  è¿™ä¸ªæ–¹æ³•æœ‰ç‚¹ä¼ å¥‡ï¼Œå®ƒæ‰¾ä¸åˆ°è®ºæ–‡ã€‚

åˆ°P13 21ï¼š22
